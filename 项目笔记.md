> #day01

# 1. 创建项目 + 自动启动 + 清理工作

1. 创建之前查看一下淘宝镜像

```js
npm get registry

结果 ==>  https://registry.npm.taobao.org/   如果出现这个结果说明是已经安装淘宝镜像了
```

2. 设置为淘宝镜像

```js
npm config set registry https://registry.npm.taobao.org/
```

3. 安装 vue-cli(vue 脚手架)
   `npm i @vue/cli -g`

4. 创建项目 `vue create xxx`

5. 选择 hash 模式
   路由(vue react) ==> hash 模式 (带# = vue)
   history 模式(不带# = react)

# 2. 全局样式文件

1. 在 styles 里面新建 base.less 文件，初始化样式

2. 在 main.js 中引入
   `import './styles/base.less'`

# 3. 配置 rem

1. 安装第一个包 :`npm i lib-flexible`
   作用 ：根据屏幕添加 fontsize

2. 引入（main.js）
   `import 'lib-flexible'`

3. 安装第二个包 ：`npm i postcss-px2rem`
   作用：自动把 px 转化成 rem

4. 在 `vue.config.js` 里面添加一些配置

```js
module.exports = {
  devServer: {
    open: true
  },
  // 配置 px 转 rem 的
  css: {
    loaderOptions: {
      css: {},
      postcss: {
        plugins: [
          require('postcss-px2rem')({
            // rem 的单位  填设计稿的 1/10
            remUnit: 37.5
          })
        ]
      }
    }
  }
}
```

5. 重启（**重要**）

6. 这个 rem 单位的设置：设计稿的 1/10

7. 在公司里应该怎么做？
   7.1 要看设计图为多少？ 750 => 75 / 375 => 37.5

   7.2 看到的设计图上的尺寸是多少，就写多少即可，rem 的配置会帮我们自动缩放

# 4. 登录功能

1. 新建 views 文件夹，并且新建两个组件页面 Login.vue / Register.vue
2. 组件 => 页面组件(views) 公共组件(components)
3. 页面组件 都是通过路由控制显示的（★）
4. 公共组件 都是通过全局注册 / 局部注册使用的

# 5. 设置路由

1. 创建 router/index.js => 配置路由

   -- 细节：项目中：`Vue.use(VueRouter)`

2. main.js 里面引入了路由 => 挂载

3. 入口 => 匹配规则 => 组件 => 出口

   -- 入口：hash 地址
   -- 规则：routes:[{ path, component }]
   -- 组件：引入即可
   -- 出口：在 根组件 App.vue 里面写一个`<router-view></router-view>`

# 6. 封装 HmHeader.vue (公共组件)

1. 创建 components/HmHeader.vue
2. 全局注册组件使用 (main.js)

```js
import HmHeader from './components/HmHeader.vue'
Vue.component('hm-header', HmHeader)
```

3. 使用公共组件 `<hm-header></hm-header>`

# 7. 插槽的使用 slot

1. 登录页：`<hm-header>登录<hm-header>`
2. 注册页：`<hm-header>注册<hm-header>`
3. hm-header 的组件内部使用 :`<slot><slot>`

# 8. 字体图标

8.1 把本地的 `iconfont.css` 拷贝到 `styles/`

8.2 引入：在 main.js 文件中引入 iconfont.css 文件

8.3 使用：`<i class='iconfont iconjiantou2'>`

# 9. HmHeader.vue 内部布局 .left .center .right

# 10. 封装 HmLogo.vue (公共组件)

10.1 创建
10.2 注册
10.3 使用
10.4 细节

# 11. 封装 HmButton.vue (公共组件)

11.1 创建
11.2 注册
11.3 使用
11.4 细节

# 12. scoped

操作：在当前组件里面 style 头标签里面添加 scoped`<style scoped>`
作用：让当前组件内的样式只能对当前组件内的标签起效果

# 13. less

操作：在当前组件里面 style 头标签里面添加 lang="less"`<style lang="less">`

> #day02

# 14. 重定向

在 router>index.js 中设置重定向
页面一打开重定向为登录页

# 15. vue 常用的一个 ui 组件库

- 移动端 : vant (有赞) https://youzan.github.io/vant/#/zh-CN/quickstart

- pc 端 : element (饿了么)

# 16. vant 的快速上手安装 ==> 输入框

1 安装：`npm i vant`

2 按需引入组件 (推荐)

2.1 安装 babel 的插件 :
`npm i babel-plugin-import -D`

2.2 在 根目录下的`babel.config.js`里面添加配置

```js
plugins: [
  [
    'import',
    {
      libraryName: 'vant',
      libraryDirectory: 'es',
      style: true
    },
    'vant'
  ]
]
```

2.3 使用：

```js
import { Field } from 'vant'

Vue.use(Field)
```

2.4 **重启**

# 17. 输入框结构

```html
<van-field
  v-model="username"
  required
  label="用户名"
  placeholder="请输入用户名"
  error-message="用户名格式错误"
  clearable
/>
```

# 18. 校验 - 用户名

1. 监听输入框文本的变化 `@input = 'checkUsername'`（注：也可以切换 @input 为@blur(失焦的时候触发)）

2. 在 checkUsername 里面通过正则进行校验`reg.test(this.username)`

3. 绑定一个值
   `:error-message='usernameErrMsg'` 并且默认为''

4. 校验成功 `this.usernameErrMsg = ''`
   校验失败`this.usernameErrMsg = '用户名格式错误'`

# 19. 校验 - 清除

```js
 @clear="clearUsername"
 // 清除用户名
    clearUsername() {
      this.usernameErrMsg = ''
    },
```

# 20. 注册页面的输入框完善

# 21. 点击登录按钮

-- 不能直接给`我们封装的组件`注册点击等事件

-- 方法 1 :

1. `<hm-button @click='startLogin' />`把 click 自定义事件传给了 hm-button
2. 在 hm-button 的组件内部, 它的根节点 `<div class='hm-button' @click='fn'>`
3. `fn(){ this.$emit('click') }`

-- 方法 2 : 语法糖（推荐）
`<hm-button @click.native='startLogin' />`

# 23. 点击登录之前的再次校验

-- 防止明知道有错误还依然点击发送请求了

```js
startLogin() {
      // 有值 + 格式正确
      if (
        this.username !== '' &&
        this.password !== '' &&
        this.usernameErrMsg === '' &&
        this.passwordErrMsg === ''
      ) {
        console.log('点击登录了')
      } else {
        console.log('校验失败')
      }
    },
```

# 24. 组件 Toast 的使用

1. 引入 : 在 main.js 里面引入 + Vue.use(Toast)

2. 全局使用: `Toast('提示内容')`

3. 局部(组件内部)使用 :

   -- 普通提示 : `this.$toast('该城市有20000人')`

   -- 成功提示 : `this.$toast.success('成功')`

   -- 失败提示 :`this.$toast.fail('失败')`

   -- 加载提示 : `this.$toast.loading('加载中...')`

# 25. 登录请求 - 准备工作

- 接口文档?? ==> 接口文档文件夹
- 服务器 ?? ==> hm-news-server-stu.zip
  (如果大家双击.bat 文件, 不成功 , 删除 node_modules, 重新下载依赖包 npm i / yarn )
- 接口 1.3 新闻文章 测试一下 看是否有数据

# 26. 开始登录

1. axios `npm i axios`
2. axios 格式

- get: 一般是获取，直接拿
  `axios.get(url,config)` config: 配置对象,{},params: 参数对象 header: 请求头对象

  例如：

  ```js
  axios.get('http://localhost:3000/user', {
    params : { id = 1},
    headers : { token }
  })
  ```

- post: 一般是添加 / 上传，需要 data 请求体参数 `axios.post(url,data,config)`

  例如：

  ```js
  axios.post(
    'http://localhost:3000/login',
    {
      username: '',
      password: ''
    },
    {
      params: {},
      headers: {}
    }
  )
  ```

- put: 一般是修改，需要 data
  `axios.put(url,data,config)`

  如果 data 为空，要写成以下形式
  `axios.put(url,null,config)`

  例如 :

  ```js
  axios.put(
    'http://localhost:3000/user/002',
    {
      gender: '女'
    },
    {
      params: {},
      headers: {}
    }
  )
  ```

- delete: 一般是删除
  `axios.delete(url,config)`

  例如 :

  ```js
  axios.delete('http://localhost:3000/user/002', {
    params: {},
    headers: {}
  })
  ```

3. 登录后的工作

```js
// 1. 保存token
localStorage.setItem('token', data.token)

// 2. 提示
this.$toast.success(message)

// 3. 跳转  /user
this.$router.push('/user')
```

# 27. 注册功能

1. 注册点击事件

2. 注册前的校验 (有值 + 校验正确)

3. 发送请求

# 28. 注册的善后工作

1. 注册成功后跳转到登录页

2. 把用户名和密码都传过来 显示
   页面 ===> 页面

3. this.$router  ==> 路由实例  ===> 方法 : push() / replace()/back()
  this.$route ===> 路由对象 ===> 属性 : path , query, params,,,

# 29. 页面之间跳转 + 携带参数 (方法 1)

1. 跳转 : (在注册页里面跳转到登录)

   ```js
   this.$router.push({
     path: '/login',
     query: {
       username: this.username,
       password: this.password
     }
   })
   ```

2. 接受 : (在登录页接受)

   ```js
   created(){
   	const { username, password } = this.$route.query
       if (username && password) {
         this.username = username
         this.password = password
       }
   }
   ```

3. 有瑕疵: 参数都放在 url 上面了

> #day03

# 1. 页面跳转携带参数的方式(必须掌握)

1. 字符串
   `this.$router.push('/login')`

2. 方式 1（p-q）

```js
this.$router.push({
  path: '/login',
  query: {}
})

this.$route.query
```

3. 方式 2（n-p）

```js
this.$router.push({
  name: '',
  params: {}
})

this.$route.params
```

# 2. 登录页的点击跳转

# 3. User.vue 个人中心

1. 创建 User.vue 组件 => 路由匹配 => 显示
2. 头部 hm-header
3. 头部信息
4. 列表

# 4. 图片的设置问题

1. object.fit: cover
   --- 等比例缩放
   --- 保证短边能显示完整

2. object.fit: contain
   --- 等比例缩放
   --- 保证长边能显示完整

# 5. Cell 和 CellGroup 的使用

```html
<van-cell-group>
  <van-cell title="我的关注" is-link value="关注的用户" />
  <van-cell title="我的跟帖" is-link value="跟帖/回复" />
  <van-cell title="我是收藏" is-link value="文档/视频" />
  <van-cell title="设置" is-link />
  <van-cell title="退出" is-link />
</van-cell-group>
```

# 6. 获取个人信息

# 7. Authorization 验证 ===> token

1. token: token 令牌
2. http 请求是个无状态的

```js
   前端浏览器 ===========> 后台服务器
   登录成功（用户名和密码） ===> 加密生成一个 token 令牌（用户名和密码）
   保存到本地 <==== token 令牌
   以后再请求数据的 + 携带 token ====> 解析 token 进行一个验证
```

# 8. 获取用户详情

1. 需要 1: token
2. 需要 2: 用户 id
3. 需要 1 和 需要 2 其实都在 登录后返回给我们了，我们只需要保存一下即可
4. 在 User.vue 里面, 获取 token 和 user_id 发送请求即可

```js
// 获取token
let token = localStorage.getItem('token')
let user_id = localStorage.getItem('user_id')

axios
  .get(`http://localhost:3000/user/${user_id}`, {
    headers: {
      Authorization: token
    }
  })
  .then(res => {
    console.log('获取用户详情', res.data)
  })
```

# 9. vue-devTools 的安装

# 10. 使用 moment + 过滤器 处理日期

1. 下载 `npm i moment`
2. 使用

```js
// 注册一个全局过滤器
import moment from 'moment'
Vue.filter('date', function(val, format = 'YYYY-MM-DD') {
  return moment(val).format(format)
})
// 以后使用
//  | date
//  | date('YYYY-MM-DD hh:mm')
```

# 11. axios 的处理

问题 1: 每次都要引入
解决办法: 每个组件都是 Vue 实例，所以我们可以把 axios 挂载到 Vue 原型上面

```js
// main.js
import axios from 'axios'
Vue.prototype.$axios = axios // Person.prototype.$axios = ''

//以后组件内再使用
this.$axios // p1.$axios   p2$axios
```

问题 2: 每次都要添加基准/基础地址
`axios.defaults.baseURL='http://localhost:3000'`

问题 3: 图片使用基准地址

```html
<img :src="$axios.defaults.baseURL +info.head_img" alt="" />
```

# 12. 退出功能

1. 注册点击事件
2. 确认框

```js
// 引入正常
// 使用
this.$dialog
  .confirm({
    title: '标题',
    message: '弹窗内容'
  })
  .then(() => {
    // on confirm 确定按钮
  })
  .catch(() => {
    // on cancel 取消按钮
  })
```

3. 退出功能：删除 token + 跳转到 login

```js
//1. 删除token
localStorage.removeItem('token')
localStorage.removeItem('user_id')
//2. 提示退出功能
this.$toast.success('退出成功')
//3. 跳转到login
this.$router.push('/login')
```

# 13. 未登录访问页面的问题

1. 登录过了 ===> 访问 /user ok

2. 未登录 ===> 访问 /user 不 ok => login

3. 跳转之前做一个判断（代码里）如果没有 token,则跳转到登录页

```js
if (token) {
  this.$router.push('/user')
}
```

4. 如果不是按部就班的点击跳转,而是修改入口,上面的方法就不行了 ===> 全局前置守卫

# 14. 全局前置守卫 beforeEach()

```js
// 全局前置守卫
// 1. to :   你要去哪里    305  路由对象
// 2. from  : 你从 哪里来  301  路由对象
// 3. next 是否允许进入
//   next() 允许进入
//   next(false) 不允许进入
//   next('/login') 允许进入login
router.beforeEach((to, from, next) => {
  console.log('碰到大爷了', from.path, to.path)

  next()
})
```

# 15. 处理 访问 /user

1. 目前: /login /register /user
2. 访问 /user ===> 未完待续 其他直接放行
3. 登录过了 ==> 放行
4. 没有登录过 ==> 去 login

```js
router.beforeEach((to, from, next) => {
  if (to.path === '/user') {
    // 未完待续

    let token = localStorage.getItem('token')
    if (token) {
      next()
    } else {
      next('/login')

  } else {
    // 放行
    next()
  }
})
```

# 16. 拦截器

1. 请求拦截器
2. 响应拦截器

# 16. 请求拦截器 (main.js )

--作用 : 拦截所有的 axios 请求, 统一处理一些事情 ( 统一添加了 token )

```js
// 处理前 :
// 1
this.$axios.get(`/user1/${user_id}`, {
  headers: {
    Authorization: token
  }
})
// 2
this.$axios.get(`/user2/${user_id}`, {
  headers: {
    Authorization: token
  }
})
// 3
this.$axios.get(`/user3/${user_id}`, {
  headers: {
    Authorization: token
  }
})

// 处理后 :
// 1
this.$axios.get(`/user1/${user_id}`)
// 2
this.$axios.get(`/user2/${user_id}`)
// 3
this.$axios.get(`/user3/${user_id}`)

// 前提 , 我们在请求拦截器里面统一设置了
axios.interceptors.request.use(config => {
  if (token) {
    config.headers.Authorization = token
  }
  return config
})
```

> #day04

# 1. 跳转到编辑资料页

在 Edit.vue 内 注册点击事件 => 跳转 Edit.vue

# 1. 编辑资料-布局展示

1. 头部 hm-header
2. 列表 cell

# 2. 编辑资料-获取资料

1. 请求数据
2. 渲染

# 3. 修改昵称 01-弹框

1. 弹框方式 1 : 只能显示文字

```js
this.$dialog
  .confirm({
    title: '标题',
    message: '弹窗内容'
  })
  .then(() => {
    // on confirm
  })
  .catch(() => {
    // on cancel
  })
```

2. 弹框方式 2 : 显示有组件的(使用这个)

```html
<van-dialog v-model="show" title="标题" show-cancel-button>
  <img src="https://img.yzcdn.cn/vant/apple-3.jpg" />
</van-dialog>

show : true/false
```

3. 修改成我们想要的样子

4. 点击的时候才显示, 开始 false, 点击 修改为 true

5. 数据回显
   --- 给 <van-field> (V) ==> 绑定一个数据 ==> nickname(M)
   --- 点击 cell 的时候,除了显示弹框,还要改变 nickname 的值 `this.nickname = this.info.nickname`

# 4. 修改昵称 02-点击确定发送请求

1. 请求之前做一个判断, 如果修改后的昵称 和 之前的昵称一样就不要发送请求了

2. 发送请求

```js
this.$axios
  .post(`/user_update/${user_id}`, {
    nickname: this.nickname
  })
  .then(res => {
    console.log('修改昵称', res.data)
    // 1. 获取最新的昵称
    this.getInfo()

    // 2. 弹框
    this.$toast.success('修改昵称成功')
  })
```

# 5. 修改性别

1. 点击 cell ==> 弹框 + 数据回显
2. 点击 确定 ==> 判断 + 发送请求修改性别

# 5.1. 点击 cell

5.1.1 弹框 (细心)

```js
name='1'  ==> 把'1'这个字符串赋值给 name
:name='1' ==> 把 1 这个原始类型数字 赋值给name

isOK = 'true'
:isOK = 'true'
```

5.1.2 数据回显 `this.gender = this.info.gender`

# 5.2 点击确定

# 6. 请求拦截器

```js
// 请求拦截器
axios.interceptors.request.use(config => {
  let token = localStorage.getItem('token')

  if (token) {
    config.headers.Authorization = token
  }

  return config
})
```

# 7. 响应拦截器 - 处理 token 失效

```js
// 响应拦截器
axios.interceptors.response.use(res => {
  const { statusCode, message } = res.data

  if (statusCode === 401 && message === '用户信息验证失败') {
    //1. 本地失效的token删除
    localStorage.removeItem('token')
    localStorage.removeItem('user_id')

    //2. 跳转到login
    router.push('/login')
  }

  return res
})
```

# 8. 封装

```js
// 封装后的函数 - 编辑资料
    ml_editUser(data){

     let user_id = localStorage.getItem('user_id')
     this.$axios.post(`/user_update/${user_id}`,data).then(res => {

        //1 获取最新的数据
        this.getInfo()
        //2 弹框
        this.$toast.success(res.data.message)
      })
    }
```

# 9. 修改头像 - 布局

9.1 引入 van-uploader
9.2 把 van-uploader 放到 img 下面
9.3 样式

# 10. 修改头像 - 上传请求

要注意别忘了有两个请求 :
第一个请求 : 把图片上传到后台, 返回给我们一个 url ( 图片 => url )

```js
:after-read='afterRead'

afterRead(data) {
  // data.file
  //1. FormData    ===>  data
  let formdata = new FormData()
  formdata.append('file',data.file)

  //2. 上传
  this.$axios.post('/upload',data).then(res => res.data.data.url)
}
```

第二个请求 : 修改头像(url)

```js
this.ml_editUser({
  head_img: res.data.data.url
})
```
